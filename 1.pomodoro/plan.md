# 実装計画（フェーズ分割）

この文書は、ポモドーロタイマーWebアプリを段階的に実装するための計画です。各フェーズごとに目的、成果物、受け入れ条件、推定工数（概算）を示します。

## フェーズ0 — 準備（1日）
- 目的: 開発環境とプロジェクト雛形を用意する
- 成果物:
  - `create_app()` を備えた Flask プロジェクト構成
  - `requirements.txt`（最小依存）
  - 空の `templates/index.html` と `static/` ディレクトリ
- 受け入れ条件: `flask run` でトップページが返ること

## フェーズ1 — 静的UI雛形（1–2日）
- 目的: モックに沿った静的な HTML/CSS を作成し、基本レイアウトを確定する
- 成果物:
  - `templates/index.html`, `static/css/styles.css`
  - モックに近いレイアウト（円形領域のプレースホルダ、ボタン、下部カード）
- 受け入れ条件: ブラウザで見た目がモックに近いこと（レスポンシブは最小限）

## フェーズ2 — タイマー純ロジック（1–2日）
- 目的: クライアント／サーバに依存しないタイマーのビジネスロジックを実装してテスト可能にする
- 成果物:
  - `static/js/timer_logic.js`（開始/停止/リセット、残時間計算、状態遷移）
  - 単体テスト（例: Jestまたは簡易テストスクリプト）
- 受け入れ条件: ロジック関数が期待通りに時間計算・状態遷移すること（テスト通過）

## フェーズ3 — クライアントタイマーUI（2日）
- 目的: `timer_logic` を UI に接続し、動作するタイマーを実装する
- 成果物:
  - `static/js/timer_ui.js`（DOM 操作、イベントバインド）
  - 開始/一時停止/リセット操作が動作する画面
- 受け入れ条件: ボタン操作でカウントダウンが正しく動作すること

## フェーズ4 — 円形プログレス表示（1日）
- 目的: SVG で円形プログレスを描画し、時間経過と連動させる
- 成果物:
  - `static/js/progress.js`（SVG stroke-dasharray を用いた実装）
  - スタイル調整でモックの見た目に近づける
- 受け入れ条件: プログレスが残り時間に同期して更新されること

## フェーズ5 — 基本APIとDB（2日）
- 目的: 開始/完了をサーバに記録する最小限の API を実装する
- 成果物:
  - `app/models.py`（`Pomodoro` モデル）
  - `app/routes/api.py` に `/api/start`, `/api/complete`, `/api/stats`
  - SQLite 設定（`config.py` の `TestingConfig` も整備）
- 受け入れ条件: API 呼び出しで DB にレコードが保存されること（簡易統合テスト）

## フェーズ6 — ローカル同期と再送（1–2日）
- 目的: オフライン時の操作を `localStorage` に保持し、接続復帰時にサーバへ再送する
- 成果物:
  - 同期キュー実装（保存・再送・エラーハンドリング）
  - 指定の再試行戦略（指数バックオフ等）
- 受け入れ条件: ネットワーク切断→再接続で未送信イベントがサーバに反映されること

## フェーズ7 — 日次集計とダッシュボード（1日）
- 目的: 今日の進捗カード（完了数・合計集中時間）をバックエンド集計で表示する
- 成果物:
  - `/api/stats` の整備、フロント側カード更新ロジック
- 受け入れ条件: 日次データが正しく表示されること

## フェーズ8 — 設定・通知・履歴（2–3日）
- 目的: UX 向上のため設定保存、通知、履歴表示を実装する
- 成果物:
  - 設定画面（時間・サウンド・自動開始等）
  - デスクトップ通知とサウンド再生
  - 履歴一覧ページ/モーダル
- 受け入れ条件: 設定が永続化され、通知が許可下で動作すること

## フェーズ9 — テスト整備と CI（2日）
- 目的: ユニット・統合・E2E テストを導入し、自動化する
- 成果物:
  - `pytest` によるバックエンドテスト群
  - フロントのロジック単体テスト（Jest）
  - GitHub Actions のワークフロー（lint + test）
- 受け入れ条件: プルリクで CI が動作し、テストが通ること

## フェーズ10 — オプション実装（随時）
- リアルタイム同期（WebSocket）、認証、CSV エクスポート等はユーザーニーズに応じて追加

## リスクと軽減策
- 時間計測の精度: クライアントのタイマーはタブ非アクティブ時に遅延する可能性がある。対策: 実時間差分ベース実装（start_time と now の差で計算）
- オフライン同期の競合: 同じセッションの重複記録を避けるため、サーバ側で idempotency（ID またはタイムスタンプ検証）を用意する

## 推奨開発フロー
1. フェーズ0〜4 を先に実施し、見た目と基本操作が動くプロトタイプを作る
2. フェーズ5〜7 で永続化と同期ロジックを実装し、データの信頼性を確保する
3. フェーズ8〜9 で UX と品質を高める

---
作成日: 2026-02-24
